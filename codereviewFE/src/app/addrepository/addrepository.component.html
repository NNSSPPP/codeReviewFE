<div class="page-wrapper">
  <div class="form-card">
    <h2>Add Repository</h2>

    <form #repoForm="ngForm" (ngSubmit)="onSubmit(repoForm)">

      <!-- Repository Information -->
      <fieldset>
        <legend>Repository Information</legend>

        <div class="mb-3">
          <label for="name" class="form-label">Repository Name <span class="required">*</span></label>
          <input type="text" class="form-control" name="name"
                 [(ngModel)]="gitRepository.name" required minlength="3" #name="ngModel">
          <div class="error" *ngIf="name.invalid && name.touched">Name is required (min 3 chars).</div>
        </div>

        <div class="mb-3">
          <label for="url" class="form-label">Git URL <span class="required">*</span></label>
          <input type="url" class="form-control" name="url"
                 [(ngModel)]="gitRepository.url" required #url="ngModel">
          <div class="error" *ngIf="url.invalid && url.touched">Valid URL required.</div>
        </div>

        <div class="mb-3">
          <label for="type" class="form-label">Project Type <span class="required">*</span></label>
          <select class="form-select" name="type"
                  [(ngModel)]="gitRepository.type" required #type="ngModel">
            <option value="">-- Select Type --</option>
            <option value="angular">Angular</option>
            <option value="springboot">Spring Boot</option>
          </select>
          <div class="error" *ngIf="type.invalid && type.touched">Project type required.</div>
        </div>

        <div class="mb-3">
          <label for="branch" class="form-label">Default Branch <span class="required">*</span></label>
          <input type="text" class="form-control" name="branch"
                 [(ngModel)]="gitRepository.branch" required #branch="ngModel">
          <div class="error" *ngIf="branch.invalid && branch.touched">Branch required.</div>
        </div>
      </fieldset>

      <!-- Authentication -->
      <fieldset>
        <legend>Authentication<span class="required"> *</span></legend>

        <div class="mb-3">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="auth1" name="authMethod"
                   [(ngModel)]="authMethod" value="usernamePassword" required>
            <label class="form-check-label" for="auth1">Username / Password</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="auth2" name="authMethod"
                   [(ngModel)]="authMethod" value="accessToken" required>
            <label class="form-check-label" for="auth2">Access Token</label>
          </div>
        </div>

        <div *ngIf="authMethod === 'usernamePassword'">
          <div class="mb-3">
            <label for="username" class="form-label">Username <span class="required">*</span></label>
            <input type="text" class="form-control" name="username"
                   [(ngModel)]="gitRepository.credentials.username" required #username="ngModel">
            <div class="error" *ngIf="username.invalid && username.touched">Username required.</div>
          </div>

          <div class="mb-3">
            <label for="password" class="form-label">Password <span class="required">*</span></label>
            <input type="password" class="form-control" name="password"
                   [(ngModel)]="gitRepository.credentials.password" required minlength="6" #password="ngModel">
            <div class="error" *ngIf="password.invalid && password.touched">Password min 6 chars.</div>
          </div>
        </div>

        <div *ngIf="authMethod === 'accessToken'">
          <div class="mb-3">
            <label for="token" class="form-label">Access Token <span class="required">*</span></label>
            <input type="text" class="form-control" name="token"
                   [(ngModel)]="gitRepository.credentials.token" required minlength="10" #token="ngModel">
            <div class="error" *ngIf="token.invalid && token.touched">Token min 10 chars required.</div>
          </div>
        </div>
      </fieldset>

      <!-- SonarQube Config -->
      <fieldset>
        <legend>SonarQube Configuration</legend>

        <div class="mb-3">
          <label for="serverUrl" class="form-label">SonarQube Server <span class="required">*</span></label>
          <input type="url" class="form-control" name="serverUrl"
                 [(ngModel)]="sonarConfig.serverUrl" required #serverUrl="ngModel">
          <div class="error" *ngIf="serverUrl.invalid && serverUrl.touched">Valid server URL required.</div>
        </div>

        <div class="mb-3">
          <label for="projectKey" class="form-label">Project Key <span class="required">*</span> </label>
          <input type="text" class="form-control" name="projectKey"
                 [(ngModel)]="sonarConfig.projectKey" required #projectKey="ngModel">
          <div class="error" *ngIf="projectKey.invalid && projectKey.touched">Project key required.</div>
        </div>

        <!-- custom round checkboxes -->
        <div class="form-check">
          <input class="form-check-input custom-check" type="checkbox" id="autoScan"
                 [(ngModel)]="sonarConfig.enableAutoScan" name="enableAutoScan" checked>
          <label class="form-check-label" for="autoScan">Enable Automatic Scanning</label>
        </div>

        <div class="form-check">
          <input class="form-check-input custom-check" type="checkbox" id="qualityGate"
                 [(ngModel)]="sonarConfig.enableQualityGate" name="enableQualityGate" checked>
          <label class="form-check-label" for="qualityGate">Enable Quality Gate Check</label>
        </div>
      </fieldset>

      <!-- Actions -->
      <div class="actions">
        <button type="button" class="btn btn-danger" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="onTest()">Test Connection</button>
        <button type="submit" class="btn btn-success" [disabled]="!repoForm.valid">Save</button>
      </div>
    </form>
  </div>
</div>
