<div class="container mt-4 assignment-wrapper">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3><i class="bi bi-list-task"></i> My Assignments</h3>
      
        <button class="btn btn-outline-primary" (click)="openAssignModal()">
          <i class="bi bi-person-check"></i> Assign Issue
        </button>
      </div>
      
  
    <table class="table table-bordered assignment-table">
      <thead>
        <tr>
          <th>Assigned To</th>
          <th>Priority</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Resolution</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let a of assignments">
          <td>{{ a.assignedTo }}</td>
          <td><span class="badge bg-{{getPriorityColor(a.priority)}}">{{ a.priority }}</span></td>
          <td>{{ a.dueDate | date }}</td>
          <td>{{ a.status }}</td>
          <td>{{ a.resolution || '-' }}</td>
        </tr>
      </tbody>
    </table>
  
    
  </div>


<!-- Modal -->
<div class="modal modal-backdrop-custom" 
     [ngClass]="showAssignModal ? 'modal-show' : 'modal-hide'" 
     (click)="closeAssignModal()">
  <div class="modal-dialog modal-dialog-custom" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-person-check"></i> Assign Issue</h5>
        <button type="button" class="btn-close" (click)="closeAssignModal()"></button>
      </div>

      <div class="modal-body">
        <form #assignmentForm="ngForm" (ngSubmit)="onSubmit(assignmentForm)" novalidate>

          <!-- Assign To -->
          <div class="mb-3">
            <label for="assignedTo" class="form-label">Assign To</label>
            <select class="form-select" [(ngModel)]="assignment.assignedTo" 
                    name="assignedTo" #assignedTo="ngModel" required>
              <option value="" disabled selected>-- Select User --</option>
              <option *ngFor="let user of users" [value]="user.name">{{ user.name }}</option>
            </select>
            <div *ngIf="assignedTo.invalid && (assignedTo.dirty || assignedTo.touched)" class="text-danger small">
              Please select a user.
            </div>
          </div>

          <!-- Priority -->
          <div class="mb-3">
            <label for="priority" class="form-label">Priority</label>
            <select class="form-select" [(ngModel)]="assignment.priority" 
                    name="priority" #priority="ngModel" required>
              <option value="" disabled selected>-- Select Priority --</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="critical">Critical</option>
            </select>
            <div *ngIf="priority.invalid && (priority.dirty || priority.touched)" class="text-danger small">
              Please select a priority.
            </div>
          </div>

          <!-- Due Date -->
          <div class="mb-3">
            <label for="dueDate" class="form-label">Due Date</label>
            <input type="date" class="form-control" [(ngModel)]="assignment.dueDate" 
                   name="dueDate" #dueDate="ngModel" required>
            <div *ngIf="dueDate.invalid && (dueDate.dirty || dueDate.touched)" class="text-danger small">
              Please select a due date.
            </div>
          </div>

          <!-- Status -->
          <div class="mb-3">
            <label for="status" class="form-label">Status</label>
            <select class="form-select" [(ngModel)]="assignment.status" 
                    name="status" #status="ngModel" required>
              <option value="" disabled selected>-- Select Status --</option>
              <option value="open">Open</option>
              <option value="in-progress">In Progress</option>
              <option value="resolved">Resolved</option>
              <option value="closed">Closed</option>
            </select>
            <div *ngIf="status.invalid && (status.dirty || status.touched)" class="text-danger small">
              Please select a status.
            </div>
          </div>

          <!-- Resolution -->
          <div class="mb-3" *ngIf="assignment.status === 'resolved' || assignment.status === 'closed'">
            <label for="resolution" class="form-label">Resolution</label>
            <textarea class="form-control" [(ngModel)]="assignment.resolution" 
                      name="resolution" #resolution="ngModel" required></textarea>
            <div *ngIf="resolution?.invalid && (resolution?.dirty || resolution?.touched)" class="text-danger small">
              Resolution is required when status is Resolved/Closed.
            </div>
          </div>

          <!-- Footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeAssignModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="assignmentForm.invalid">
              Save Assignment
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

