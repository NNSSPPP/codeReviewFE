<div class="scan-history-container p-4">
  <h2><i class="bi bi-journal-text"></i> Scan History</h2>

  <!-- Date Filter -->
  <div class="filter-row my-3 d-flex flex-wrap align-items-center gap-2">
    <label for="dateRange">Date Range:</label>

    <div class="date-wrapper">
      <input type="date" [(ngModel)]="startDate" class="form-control form-control-sm" />
      <span class="calendar-icon"></span>
    </div>

    <span>to</span>

    <div class="date-wrapper">
      <input type="date" [(ngModel)]="endDate" class="form-control form-control-sm" />
      <span class="calendar-icon"></span>
    </div>

    <button class="btn btn-primary btn-sm" (click)="applyFilter()">
      <i class="bi bi-search"></i> Search
    </button>
    <button class="btn btn-secondary btn-sm" (click)="clearFilter()">
      <i class="bi bi-x-circle"></i> Clear
    </button>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Date/Time</th>
          <th>Project</th>
          <th>Grade</th>
          <th>Issues</th>
          <th>Log</th>
          <th>Result</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let scan of pagedScans">
          <td>
            {{scan.date | date:'yyyy-MM-dd'}} <br /> {{scan.time}}
          </td>
          <td>
            {{scan.project}} <br />
            <span [ngClass]="statusClass(scan.status)">
              <i [ngClass]="statusIcon(scan.status)"></i> {{scan.statusText}}
            </span>
          </td>
          <td>{{scan.grade}} ({{scan.percentage}}%)</td>
          <td>
            <span *ngIf="scan.issues.bugs"><i class="bi bi-bug"></i> {{scan.issues.bugs}}</span>
            <span *ngIf="scan.issues.locks"><i class="bi bi-lock"></i> {{scan.issues.locks}}</span>
            <span *ngIf="scan.issues.warnings"><i class="bi bi-exclamation-triangle"></i> {{scan.issues.warnings}}</span>
          </td>
          <td>
            <button class="btn btn-log btn-sm" (click)="viewLog(scan)">
              <i class="bi bi-file-text"></i> View Log
            </button>
          </td>
          <td>
            <button class="btn btn-primary btn-sm" (click)="viewResult(scan)">
              <i class="bi bi-search"></i> View Result
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav *ngIf="totalPages > 1" class="my-2">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="goPage(currentPage - 1)">
          <i class="bi bi-chevron-left"></i>
        </a>
      </li>
      <li class="page-item" *ngFor="let p of pages" [class.active]="p === currentPage">
        <a class="page-link" (click)="goPage(p)">{{p}}</a>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="goPage(currentPage + 1)">
          <i class="bi bi-chevron-right"></i>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Actions -->
  <div class="actions mt-3 d-flex gap-2 flex-wrap">
    <button class="btn btn-success btn-sm" (click)="exportHistory()">
      <i class="bi bi-download"></i> Export History
    </button>
    <button class="btn btn-info btn-sm" (click)="compareScans()">
      <i class="bi bi-bar-chart"></i> Compare Scans
    </button>
    <button class="btn btn-danger btn-sm" (click)="clearLogs()">
      <i class="bi bi-trash"></i> Clear Old Logs
    </button>
  </div>
</div>
